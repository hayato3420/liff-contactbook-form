<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>連絡帳フォーム</title>
  <link rel="stylesheet" href="style.css">
  
    <script src="https://static.line-scdn.net/liff/sdk/2.2.0/liff.js"></script>
  <script>
    // LIFF初期化とID取得
    async function initializeLiff() {
        try {
            await liff.init({ liffId: '2008084904-LDljg5dl' }); // ★★★ あなたのLIFF IDに置き換え ★★★
            if (liff.isLoggedIn()) {
                const profile = await liff.getProfile();
                document.getElementById('userIdInput').value = profile.userId;
            } else {
                // ログインしていない場合はログインを促す
                liff.login();
            }
        } catch (err) {
            console.error('LIFF初期化エラー:', err);
            // エラー時でもフォームは表示
        }
    }
    initializeLiff();
  </script>
  </head>
<body>
  <div class="wrap">
        <form id="reportForm">
                
                <input type="hidden" id="userIdInput" name="userId" value="" />
                
        <button id="submitBtn" type="submit">送信する</button>
    </form>
  </div>

  <script>
    // ====== あなたのGASのURLに置き換える ======
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzQE9drzU6bhb5UbtybsqBAZBFMnDciI3lO8CxjgfVt1lFNVADeaRMYEXQmtomnuz58/exec";
    // =========================================

    const form = document.getElementById('reportForm');
    const alertBox = document.getElementById('alert');
    const okBox = document.getElementById('ok');
    const submitBtn = document.getElementById('submitBtn');

    function showAlert(msg){ /* ... 省略 ... */ }
    function showOk(msg){ /* ... 省略 ... */ }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      showAlert('');
      submitBtn.disabled = true;
      submitBtn.textContent = '送信中…';

      // 1. 入力値の取得
      const name = document.getElementById('nameInput').value;
      const temp = document.getElementById('tempInput').value;
      const condition = document.getElementById('conditionInput').value;
      const content = document.getElementById('contentInput').value;
      const userId = document.getElementById('userIdInput').value; // ★★★ IDを取得 ★★★

      // 必須入力チェック (IDが取得できていない場合はエラー)
      if (!name || !temp || !condition || !content || !userId) {
          showAlert("すべての項目を入力してください。または、LINE IDの取得ができませんでした。再度お試しください。");
          submitBtn.disabled = false;
          submitBtn.textContent = '送信する';
        return;
      }

      // 2. 送信するデータをJSON形式で準備
      const payload = {
        name: name,
        temp: temp,
        condition: condition,
        content: content,
        userId: userId // ★★★ payloadにIDを含める ★★★
      };

      // 3. GASのdoPost関数にデータを送信（fetch APIを使用）
      // ... 省略 ...
      // ... 既存の fetch/try/catch ロジックをそのまま使用 ...
      // ... 
      try {
        const res = await fetch(GAS_WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        showOk("送信しました。ご入力ありがとうございます。");
        document.getElementById('reportForm').reset();
      } catch(err){
        console.error('送信エラー:', err);
        showAlert('送信に失敗しました。URLや通信環境をご確認ください。');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '送信する';
      }
    });
  </script>
</body>
</html>
