<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>連絡帳フォーム</title>
    
    <link rel="stylesheet" href="style.css">
    
    </head>
<body>
    <div class="wrap">
        <div class="card">
            <h1>連絡帳フォーム</h1>
            <p class="desc">朝の体調や連絡事項を入力して送信してください。</p>

            <div id="alert" class="err"></div>
            <div id="ok" class="ok"></div>

            <form id="reportForm">
                <div class="row">
                    <label for="nameInput">お子さまの名前f</label>
                    <select id="nameInput" required>
                        <option value="">選択してください</option>
                        <option>元気</option>
                        <option>少しだるい</option>
                        <option>咳・鼻水あり</option>
                        <option>発熱あり</option>
                        <option>その他</option>
                    </select>
                </div>

                <div class="row">
                    <label for="tempInput">体温（℃）</label>
                    <input type="number" id="tempInput" step="0.1" min="34" max="41" placeholder="例: 36.8" required />
                </div>
                
                <div class="row">
                    <label for="conditionInput">体調</label>
                    <select id="conditionInput" required>
                        <option value="">選択してください</option>
                        <option>元気</option>
                        <option>少しだるい</option>
                        <option>咳・鼻水あり</option>
                        <option>発熱あり</option>
                        <option>その他</option>
                    </select>
                </div>
                
                <div class="row">
                    <label for="contentInput">連絡したい内容</label>
                    <textarea id="contentInput" required placeholder="例）薬を持たせました。お迎えは17:30予定です。"></textarea>
                </div>
                
                <button id="submitBtn" type="submit">送信する</button>
            </form>
            
            <button type="button" class="secondary-btn" id="historyBtn">
                自分の報告履歴を見る
            </button>
        </div>
    </div>

    <script>
        // ★★★ あなたのGASのURLに置き換え ★★★
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyhefCTuBmNihNeeZsd4gN4IW8EGOaZ6hlMCsIOx66RoGQ5nDMiyfJCKmUQV18iwl4ffw/exec";
        // =========================================

        const form = document.getElementById('reportForm');
        const alertBox = document.getElementById('alert');
        const okBox = document.getElementById('ok');
        const submitBtn = document.getElementById('submitBtn');
        const historyBtn = document.getElementById('historyBtn');

        function showAlert(msg){ 
            alertBox.textContent = msg;
            alertBox.style.display = msg ? 'block' : 'none';
            okBox.style.display = 'none';
        }
        function showOk(msg){ 
            okBox.textContent = msg;
            okBox.style.display = 'block';
            alertBox.style.display = 'none';
        }

        // フォーム送信処理
        form.addEventListener('submit', async (e)=>{
            e.preventDefault();
            showAlert('');
            submitBtn.disabled = true;
            submitBtn.textContent = '送信中…';

            const name = document.getElementById('nameInput').value;
            const temp = document.getElementById('tempInput').value;
            const condition = document.getElementById('conditionInput').value;
            const content = document.getElementById('contentInput').value;
            
            // 必須入力チェック
            if (!name || !temp || !condition || !content) {
                showAlert("すべての項目を選択・入力してください。");
                submitBtn.disabled = false;
                submitBtn.textContent = '送信する';
                return;
            }
            
            // userIdを含まないpayload
            const payload = { name, temp, condition, content };

            try {
                // GASのdoPost関数にデータを送信
                const res = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await res.json();
                if (result.result === 'error') {
                     throw new Error('サーバー処理エラー: ' + result.message);
                }

                showOk("送信しました。ご入力ありがとうございます。");
                document.getElementById('reportForm').reset();
                
            } catch(err){
                console.error('送信エラー:', err);
                showAlert('送信に失敗しました。URLや通信環境をご確認ください。');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '送信する';
            }
        });
        
        // 履歴ボタン処理 (index.htmlでは動作しません)
        historyBtn.addEventListener('click', () => {
            showAlert("LIFFによる認証機能がないため、履歴を表示できません。");
        });
    </script>
</body>
</html>
